# -*- coding: utf-8 -*-
# @Author: watcher
# @Created Time: 2025/2/17 11:11
# @File: __init__.py
# @Email: mlshenkai@163.com
import os
from openai import OpenAI

client = OpenAI(
    # 若没有配置环境变量，请用百炼API Key将下行替换为：api_key="sk-xxx",
    api_key="sk-4b7158cbb3e7447a88196df92667b867",  # 如何获取API Key：https://help.aliyun.com/zh/model-studio/developer-reference/get-api-key
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
)
content = """请从以下文本中提取关键信息，并按照指定格式输出：

---
<数据文本内容>
① 请上传完整正确的托书，包括POL、POD 、完整收/发/通信息（例如收货人为TO ORDER，通知人必须为公司)、箱型箱量、中英文品名（HS CODE )、件数/毛重/体积、运输条款、运费条款；

② 请选择合理的ETD时间（建议，危险品：ETD-14天；普货/一般化工品：ETD-7天），如客户需要申请freetime，请提前与航管沟通并在下单时准确填写"下单Free Time"；

③ 请根据客户托书准确填写订单信息，包括下单客户企业名称、客户姓名、货物类型、提单类型、交易类型等。如创建前已明确客户的履约联系人，销售可在创建订单的界面填写"客户联系人"，若涉及客户特殊要求，均须进行完整且清晰的备注；

④ 请根据客户需求，正确勾选我司需要提供的起运港/目的港服务；

⑤ 如需以客户的订单号进行沟通，下单时须在"贸易单号"中准确填写客户订单号；

⑥如客户有签单时效、放货方式等特殊要求（常规要求例如某些目的港不接受电放，美加线原则上需出H单等），请提前与航管及履约人员沟通。如无法满足客户的要求，须在当票开始履约前和客户说明。

⑦ 如为FOB指定货，需在下单时准确填写"海外代理"；

⑧ 须提前与客户确认是否需要我司代发ISF，收货人有无BOND, 若无，需尽早联系美国分公司购买ISF BOND事宜；
</数据文本内容>

<问答文本内容>
Q1. 客户托书缺失订舱必要信息，如HS CODE。

A1. 销售需主动与客户沟通，补充缺失信息，避免影响放舱时效。

Q2. 客户托书品名过于笼统或不够完整。

A2. 销售需主动与客户沟通，确认详细品名，如沟通未果，须提示客户潜在风险（如影响放舱时效），并在下单时备注未尽事宜与明细，以便后续操作过程中把控风险。
</问答文本内容>
---

**提取要求：**  
1. **基础信息** 使用 `<基础信息></基础信息>` 标记，**必须只能从<数据文本内容></数据文本内容>中提取** 包含：
   - **业务类型** (`<业务类型></业务类型>`)：提取业务类型（如国际海运订舱、空运、陆运等）。  
   - **分公司** (`<分公司></分公司>`)：提取适用的分公司信息，如未提及则填写 "暂无明确分公司信息"。  

2. **数据部分** 使用 `<data></data>` 标记，**必须只能从<数据文本内容></数据文本内容>中提取** 包含以下子部分：
   - **系统操作** (`<系统操作></系统操作>`)：如果文本涉及如何在系统上的操作，请详细提取；如果没有，则忽略此部分，**必须只能从<数据文本内容></数据文本内容>中提取**。  
   - **数据源** (`<数据源></数据源>`)：提取所有涉及的数据字段，并注明其提取路径， **必须只能从<数据文本内容></数据文本内容>中提取**。
    - 提取路径表示在我司订单系统提取还是第三方数据源，若没有明确指明提取路径，则默认我司订单系统
    - 数据字段主要包括：收货人,发货人，通知人，起运港，目的港，中转港，货物类型，提单类型，贸易单号，件数，毛重，体积，中文品名，英文品名，运输条款，运费条款等等
    - 若原文数据字段表示与给出的不同请按照语义进行映射，如果发生映射请使用()将未映射的字段填入其中
   - **审批流程** (`<审批流程></审批流程>`)：如果有审批流程，请详细描述审批步骤和责任人；如果没有，则忽略此部分。 **必须只能从<数据文本内容></数据文本内容>中提取** **注意：在这里的审批流程表示在运去哪订单系统内部的审批流程而非所有的审核信息
   - **注意事项** (`<注意事项></注意事项>`)：列出所有需要注意、核对、确认、特殊要求的信息，如数据准确性要求、特殊约束等。**必须只能从<数据文本内容></数据文本内容>中提取** **注意：在这里，必须直接使用<数据文本内容></数据文本内容>的原文内容，不进行扩展或捏造**。  

3. **问答部分** 使用 `<question_answers></question_answers>` 标记, 所有涉及的问答成对表示：
   - **问题** 用 `<question></question>` 标记 **必须只能从<问答文本内容></问答文本内容>中提取**。  
   - **答案** 用 `<answer></answer>` 标记，**必须引用 `<data>` 部分的内容** 。  
   - **引用规则：**  
     - 仅能引用 `<data>` 内 `<注意事项>` 的原文内容，不得编造或篡改。  
     - 每个引用使用 `<ref></ref>` 标记，并且保留完整的原始内容。  
     - **若涉及多个引用条目，应使用多个 `<ref>` 标签分别引用**。  

**输出格式示例：**
```xml
<基础信息>
  <业务类型>国际海运订舱</业务类型>
  <分公司>上海分公司</分公司>
</基础信息>

<data>
  <系统操作>在系统中，进入“客户管理”模块，点击“新增客户”，填写相关信息后提交。</系统操作>
  <数据源>
    客户名称: 我司订单系统  
    客户编号: 我司订单系统  
    发货人(发货人信息): 我司订单系统
    起运港(POL): 我司订单系统
    订单号: 我司订单系统 
    HS CODE: 我司订单系统  
  </数据源>
  <审批流程></审批流程>
  <注意事项>
    1. 客户编号必须唯一，提交前需检查是否已存在。  
    2. HS CODE 需准确无误，否则可能影响放舱时效。  
    3. 核对托书信息完整性，包括 POL、POD、收/发/通信息、箱型箱量、中英文品名、HS CODE, 件数/毛重/体积、运输条款、运费条款等。  
  </注意事项>
</data>

<question_answers>
  <question>如何新增客户？</question>
  <answer>进入“客户管理”模块，点击“新增客户”，填写信息后提交。
  </answer>
  
  <question>客户编号有什么要求？</question>
  <answer>客户编号必须唯一，提交前需检查是否已存在。  
    <ref>注意事项: 客户编号必须唯一，提交前需检查是否已存在。</ref>  
  </answer>

  <question>客户托书缺失订舱必要信息，如 HS CODE，如何处理？</question>
  <answer>销售需主动与客户沟通，补充缺失信息，避免影响放舱时效。  
    <ref>注意事项: 2. HS CODE 需准确无误，否则可能影响放舱时效。</ref>
    <ref>注意事项: 3. 核对托书信息完整性，包括 POL、POD、收/发/通信息、箱型箱量、中英文品名、HS CODE, 件数/毛重/体积、运输条款、运费条款等。</ref>
  </answer>

  <question>客户托书品名过于笼统或不够完整，如何应对？</question>
  <answer>销售需主动与客户沟通，确认详细品名。如沟通未果，须提示客户潜在风险（如影响放舱时效），并在下单时备注未尽事宜与明细，以便后续操作过程中把控风险。  
    <ref>注意事项: 3. 核对托书信息完整性，包括 POL、POD、收/发/通信息、箱型箱量、中英文品名、件数/毛重/体积、运输条款、运费条款等。</ref>  
  </answer>
</question_answers>"""
completion = client.chat.completions.create(
    model="deepseek-v3",  # 此处以 deepseek-r1 为例，可按需更换模型名称。
    messages=[
        {'role': 'user', 'content': content}
    ]
)

# 通过reasoning_content字段打印思考过程
print("思考过程：")
print(completion.choices[0].message.reasoning_content)

# 通过content字段打印最终答案
print("最终答案：")
print(completion.choices[0].message.content)